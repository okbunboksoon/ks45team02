<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layout/adminDefault}">

<head>
    <!-- Datatables -->
    <link  th:href="@{/admin/vendors/datatables.net-bs/css/dataTables.bootstrap.min.css}" rel="stylesheet">
    <link  th:href="@{/admin/vendors/datatables.net-buttons-bs/css/buttons.bootstrap.min.css}" rel="stylesheet">
    <link  th:href="@{/admin/vendors/datatables.net-fixedheader-bs/css/fixedHeader.bootstrap.min.css}" rel="stylesheet">
    <link  th:href="@{/admin/vendors/datatables.net-responsive-bs/css/responsive.bootstrap.min.css}" rel="stylesheet">
    <link  th:href="@{/admin/vendors/datatables.net-scroller-bs/css/scroller.bootstrap.min.css}" rel="stylesheet">
</head>
<th:block layout:fragment="customJs">
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
</th:block>
<th:block layout:fragment="customScript">
    <script>
        $(function (){ //window.onload(요소가 다 렌더링이 되고 나서 실행)
            $('#submitBtn').click(function (){
                let isSubmint =true;
                $('#addUser input').each(function (idx,item){
                    let checkValue = $(item).val();
                    let labelValue = $(item).parents('tr').find('label').text();
                    if(typeof checkValue =='undefined'||checkValue==null||checkValue==''){
                        alert(`${labelValue}를 입력해 주세여`);
                        $(item).focus();
                        isSubmint=false;
                        return false;
                    }
                });
                if(isSubmint) $('#addUser').submit();
            });
        });

        $(function(){
            const $idData = document.getElementById('userId');
            const $submitBtn = document.getElementById('submitBtn');

            $('#userPw').attr("disabled", true);
            $('#userBirth').attr("disabled", true);
            $('#userPwCheck').attr("disabled", true);
            $('#userAddr').attr("disabled", true);
            $('#userEmail').attr("disabled", true);
            $('#userName').attr("disabled", true);
            $('#userNickName').attr("disabled", true);
            $('#userPhone').attr("disabled", true);

            function validateValue(checkValue){
                if(typeof checkValue == 'undefined' || checkValue == null || checkValue == ''){
                    return true;
                }
                return false;
            }
            $('#checkBtn').click(function(){
                const $id = $('#userId').val();
                console.log($id,"은나와라 1111");
                if(validateValue($id))
                {
                    alert('회원 아이디 입력해주세요');
                    $('#userId').focus();
                    return false;
                }

                $('#userId').keypress(function(){
                    $submitBtn.disabled = true;
                    $('#addUser input').not('#userId').prop('disabled', true);
                    $('#addUser button').not('#checkBtn').prop('disabled', true);

                })
                let idCheckApi = '/admin/idCheck/'+ $id;
                fetch(idCheckApi)
                        .then(response => response.json())
                        .then(data => {
                            console.log(data,"금나와라");
                            console.log($id,"은나와라");

                            if(data !== 0){
                                alert(`${$id} 아이디 가 있습니다`);
                                $('#userId').val('');
                                $submitBtn.disabled = true;
                                $('#addUser input').not('#userId').prop('disabled', true);
                                $('#addUser button').not('#checkBtn').prop('disabled', true);
                                $idData.focus();
                                return false;
                            }else {
                                alert("중복이 아니다 이거야~");
                                $submitBtn.disabled = false;
                                $('#addUser input').not('#userId').prop('disabled', false);
                                $('#addUser button').not('#checkBtn').prop('disabled', false);

                            }

                        })
                        .catch(err =>console.log(err));
            });
        });

    </script>
</th:block>
<th:block layout:fragment="customContents">
    <h1>회원등록</h1>
    <div class="col-md-12 col-sm-12 ">
        <div class="x_panel">
            <div class="x_content">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="card-box table-responsive">
                            <form id="addUser" th:action="@{/admin/addUser}" method="post">
                            <table id="loginHistory" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%">
                            <tbody>
                                <tr>
                                    <td>
                                        <label for="userId">회원아이디</label>
                                    </td>
                                    <td>
                                        <input type="text" id="userId" name="userId" placeholder="회원 아이디를 입력해주세요">
                                    </td>
                                    <td>
                                        <button type="button" id="checkBtn" >아이디 중복체크</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="userPw">회원비밀번호</label>
                                    </td>
                                    <td colspan="2">
                                        <input type="text" id="userPw" name="userPw" placeholder="회원 비밀번호를 입력해주세요">
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="userPwCheck">회원비밀번호확인</label>
                                    </td>
                                    <td colspan="2">
                                        <input type="text" id="userPwCheck" name="userPwCheck" placeholder="회원 비밀번호를 다시 한번 입력해주세요">
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        <label for="userName">회원이름</label>
                                    </td>
                                    <td colspan="2">
                                        <input type="text" id="userName" name="userName" placeholder="회원 이름을 입력해주세요.">
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="userNickName">닉네임</label>
                                    </td>
                                    <td colspan="2">
                                        <input type="text" id="userNickName" name="userNickName" placeholder="사용하실 닉네임을 입력해주세요.">
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        <label for="userAddr">회원주소</label>
                                    </td>
                                    <td colspan="2">
                                        <input type="text" id="userAddr" name="userAddr" placeholder="회원 주소를 입력해주세요.">
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="userPhone">회원전화번호</label>
                                    </td>
                                    <td colspan="2">
                                        <input type="text" id="userPhone" name="userPhone" placeholder="전화번호를 입력해주세요.">
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="userEmail">회원이메일</label>
                                    </td>
                                    <td colspan="2">
                                        <input type="email" id="userEmail" name="userEmail" placeholder="회원 이메일을 입력해주세요.">
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <label for="userBirth">회원생년 월일</label>
                                    </td>
                                    <td colspan="2">
                                        <input type="date" id="userBirth" name="userBirth">
                                    </td>
                                </tr>
                            </tbody>
                            <tfoot>
                            <tr>
                                <td colspan="3">
                                    <button type="button" id="submitBtn" >회원가입</button>
                                    <button type="reset" id="resetBtn">취소</button>
                                </td>
                            </tr>
                            </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</th:block>

<!-- 사용자 지정 js 파일 -->
<th:block layout:fragment="customJs">
    <!-- Datatables -->
    <script th:src="@{/admin/vendors/datatables.net/js/jquery.dataTables.min.js}"></script>
    <script th:src="@{/admin/vendors/datatables.net-bs/js/dataTables.bootstrap.min.js}"></script>
    <script th:src="@{/admin/vendors/datatables.net-buttons/js/dataTables.buttons.min.js}"></script>
    <script th:src="@{/admin/vendors/datatables.net-buttons-bs/js/buttons.bootstrap.min.js}"></script>
    <script th:src="@{/admin/vendors/datatables.net-buttons/js/buttons.flash.min.js}"></script>
    <script th:src="@{/admin/vendors/datatables.net-buttons/js/buttons.html5.min.js}"></script>
    <script th:src="@{/admin/vendors/datatables.net-buttons/js/buttons.print.min.js}"></script>
    <script th:src="@{/admin/vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js}"></script>
    <script th:src="@{/admin/vendors/datatables.net-keytable/js/dataTables.keyTable.min.js}"></script>
    <script th:src="@{/admin/vendors/datatables.net-responsive/js/dataTables.responsive.min.js}"></script>
    <script th:src="@{/admin/vendors/datatables.net-responsive-bs/js/responsive.bootstrap.js}"></script>
    <script th:src="@{/admin/vendors/datatables.net-scroller/js/dataTables.scroller.min.js}"></script>
    <script th:src="@{/admin/vendors/jszip/dist/jszip.min.js}"></script>
    <script th:src="@{/admin/vendors/pdfmake/build/pdfmake.min.js}"></script>
    <script th:src="@{/admin/vendors/pdfmake/build/vfs_fonts.js}"></script>
</th:block>
</html>